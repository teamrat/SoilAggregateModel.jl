# Repository Reorganization Instructions

**Goal**: Clean up the repository structure before first git commit.  
**Rule**: Do NOT modify any `.jl` source code or test logic. This is purely a file/directory reorganization.  
**Rule**: Do NOT delete anything without moving it to `docs/archive/` first.

---

## 1. Create directory structure

```bash
mkdir -p scripts
mkdir -p paper/simulations
mkdir -p paper/figures
mkdir -p paper/data
mkdir -p docs/archive
```

## 2. Move files

### Scripts (out of repo root)
```bash
mv diagnostics_30day.jl scripts/
```

### Documentation reorganization
```bash
# Main docs
mv claude/ARCHITECTURE_CLAUDE_CODE.md docs/ARCHITECTURE.md
mv claude/PARAMETER_BUG_REPORT.md docs/PARAMETER_BUG_REPORT.md

# Archive (historical fix notes, not ongoing references)
mv claude/MANUSCRIPT_CHANGES_FOR_CLAUDE_CODE.md docs/archive/
mv claude/STEP9_FIXES.md docs/archive/
mv claude/CRANK_NICOLSON_TEST_REQUIREMENTS.md docs/archive/

# Remove the manuscript copy — we use Overleaf, not a local copy
# Archive it rather than delete
mv claude/manuscript_20260205.tex docs/archive/

# Remove empty claude directory
rmdir claude
```

### Delete generated/temp files
```bash
rm -f diagnostics_30day_output.txt
rm -f test/test_reactions.jl.bak
```

## 3. Create paper/simulations/common.jl

This file defines canonical parameter sets for paper figures. Create a starter version:

```julia
# common.jl — Shared parameter sets and utilities for paper figures
#
# Usage: include("common.jl") at the top of each figure script
#
# This file defines the EXACT parameter sets used in the published paper.
# Do not modify after publication without documenting the change.

using SoilAggregateModel
using CairoMakie  # or whatever plotting package you choose

# === Canonical parameter set (medium-textured soil, temperate climate) ===
# These override the package defaults where needed for the paper simulations.

const PAPER_BIO = BiologicalProperties(
    # Override defaults as needed for paper
    # Example: r_B_max = 5.0, ...
)

const PAPER_SOIL = SoilProperties(
    # Override defaults as needed for paper
    # Example: k_d_eq = 0.05, ...
)

# === Standard environmental conditions ===
const T_STANDARD = 293.15    # 20°C
const ψ_STANDARD = -33.0     # Field capacity [kPa]

# === Figure output ===
const FIGURE_DIR = joinpath(@__DIR__, "..", "figures")
mkpath(FIGURE_DIR)

"""
    savepaperfig(fig, name)

Save figure to paper/figures/ as both PDF and PNG.
PDF goes to Overleaf via Dropbox sync.
"""
function savepaperfig(fig, name)
    save(joinpath(FIGURE_DIR, name * ".pdf"), fig)
    save(joinpath(FIGURE_DIR, name * ".png"), fig, px_per_unit=3)
    println("Saved: $name.pdf and $name.png")
end
```

## 4. Create paper/simulations/README.md

```markdown
# Paper Simulations

Scripts that generate figures for the aggregate formation manuscript.

## Setup
Each script loads `common.jl` for shared parameter sets and plot utilities.

## Workflow
1. Run a simulation script: `julia fig01_aggregate_lifecycle.jl`
2. Output goes to `paper/figures/`
3. Figures sync to Overleaf via Dropbox (see below)

## Overleaf integration
The `paper/figures/` directory should be symlinked to or synced with your
Dropbox folder that Overleaf reads from. Set this up once:

```bash
# Option A: Symlink (if Dropbox folder exists)
ln -s /path/to/SoilAggregateModel/paper/figures ~/Dropbox/Apps/Overleaf/YOUR_PROJECT/figures

# Option B: Copy script (add to your workflow)
# cp paper/figures/*.pdf ~/Dropbox/Apps/Overleaf/YOUR_PROJECT/figures/
```

In your LaTeX manuscript, reference figures as:
```latex
\includegraphics[width=\linewidth]{figures/fig01_aggregate_lifecycle.pdf}
```
```

## 5. Create .gitignore

```
# Generated outputs
diagnostics_30day_output.txt
paper/figures/*.pdf
paper/figures/*.png
!paper/figures/.gitkeep

# Julia
*.jl.cov
*.jl.mem
Manifest.toml

# OS
.DS_Store
Thumbs.db

# Editor
*.swp
*.swo
*~
.vscode/

# Backup files
*.bak
```

## 6. Create paper/figures/.gitkeep and paper/data/.gitkeep

Empty placeholder files so git tracks the empty directories:
```bash
touch paper/figures/.gitkeep
touch paper/data/.gitkeep
```

## 7. Update CLAUDE.md

Add this section to the existing CLAUDE.md:

```markdown
## Repository Structure
- `src/` — The Julia package. All model code lives here.
- `test/` — Unit and integration tests. Run with `julia --project -e 'using Pkg; Pkg.test()'`
- `scripts/` — Development/debugging scripts. Not part of the package.
- `paper/simulations/` — Scripts that generate paper figures. Each includes `common.jl`.
- `paper/figures/` — Generated figures. Synced to Overleaf via Dropbox. Gitignored.
- `docs/` — Architecture, guides, bug reports.
- `docs/archive/` — Historical fix notes and changelogs.

## Overleaf Workflow
Figures are generated by scripts in `paper/simulations/`, saved to `paper/figures/`,
and synced to Overleaf via Dropbox. The manuscript .tex file lives ONLY on Overleaf —
do not create or edit .tex files in this repository.

## File Creation Rules
- Model code → `src/` (appropriate subdirectory)
- Tests → `test/`
- Quick diagnostic/debug scripts → `scripts/`
- Paper figure generation → `paper/simulations/`
- Documentation → `docs/`
- Never put scripts or notebooks in `src/`
```

## 8. Verify final structure

After all moves, the tree should look like:
```
SoilAggregateModel/
├── CLAUDE.md
├── Project.toml
├── README.md
├── .gitignore
├── src/
│   ├── SoilAggregateModel.jl
│   ├── constants.jl
│   ├── types.jl
│   ├── parameters.jl
│   ├── environment.jl
│   ├── api.jl
│   ├── temperature/
│   ├── physics/
│   ├── biology/
│   ├── carbon/
│   └── solver/
├── test/
│   ├── runtests.jl
│   └── test_*.jl
├── scripts/
│   └── diagnostics_30day.jl
├── paper/
│   ├── simulations/
│   │   ├── README.md
│   │   └── common.jl
│   ├── figures/
│   │   └── .gitkeep
│   └── data/
│       └── .gitkeep
└── docs/
    ├── ARCHITECTURE.md
    ├── GUIDE.md
    ├── REFERENCE.md
    ├── PARAMETER_BUG_REPORT.md
    └── archive/
        ├── MANUSCRIPT_CHANGES_FOR_CLAUDE_CODE.md
        ├── STEP9_FIXES.md
        ├── CRANK_NICOLSON_TEST_REQUIREMENTS.md
        └── manuscript_20260205.tex
```

## 9. Run tests to confirm nothing broke

```bash
cd /path/to/SoilAggregateModel
julia --project -e 'using Pkg; Pkg.test()'
```

All 242 tests should pass. If any fail, the reorganization broke an include path — check for hardcoded relative paths in test files.

## 10. First git commit

```bash
git init
git add .
git commit -m "Initial commit: soil aggregate biogeochemical model

Single-aggregate reactive transport model with Strang splitting.
9 state variables, 5 diffusing (Crank-Nicolson), 3 immobile ODEs, 1 scalar ODE.
Corrected density parameters (ρ_b, ρ_POM). 242/242 tests passing."
```
